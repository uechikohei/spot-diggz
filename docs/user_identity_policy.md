# ユーザー識別/ユーザー名ポリシー

## 目的

- 認証方式が異なっても、同一ユーザーを安定して識別できる状態を作る
- 表示名やメール変更の影響範囲を明確にする

## 公式識別子 (Canonical ID)

- **Firebase Auth UID を唯一の識別子とする**
- API/Firestore では `userId = UID` を前提に参照・更新する
- すべてのデータリレーションは `userId` で管理する

## 表示名 (displayName)

- **任意入力**（未設定可）
- **重複は許容**（現時点は一意性を要件にしない）
- UI表示の優先順位: `displayName` → `email` → `ユーザー`
- 一意性が必要になった場合は `userHandle` を別フィールドで追加し、重複チェックを行う

## メールアドレス

- メール/パスワード認証は **アプリ内で変更可能**（将来対応）
- Google/Apple SSO は **アプリ内で変更不可**（各アカウント側で変更）
- メールは連絡用属性であり、識別子としては扱わない

## Firestore (users/{uid})

- 保持フィールド:
  - `userId` (UID)
  - `displayName` (任意)
  - `email` (任意)
  - `createdAt`, `updatedAt`
- `displayName` 未設定の場合は空/未設定で保存し、UI側でフォールバック表示する

## 影響範囲

- お気に入り、投稿者表示、ルート作成など全機能で `userId` を使用
- 表示名やメール変更はUI表示のみ影響し、データの紐付けには影響しない
