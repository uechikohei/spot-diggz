# spot-diggz 上流要件サマリー

## STAR: リプレイスプロジェクトの背景と目的
### Situation
- 旧SkateSpotSearchはRailsベースで5年前に構築され、技術的負債と保守課題を抱えていた。
- スケートスポット情報を共有し、適切な滑走場所へ導く社会的意義を持つサービスである。
### Task
- モダン技術スタックを採用しつつ、既存機能を踏襲した新アプリspot-diggzを再構築する。
- エンジニアとしてバックエンド(Rust)・フロントエンド(TypeScript/React)・インフラ(GCP)の実践スキルを獲得する。
### Action
- Rustスクラッチ実装のAPI、React/TypeScript UI、GCPサーバーレス基盤を採用するアーキテクチャを計画。
- TerraformによるIaC、CI/CD、セキュリティ/監視基盤を含めたエンタープライズ志向の設計指針を定義。
### Result
- 高パフォーマンスかつ学習効果の高いモダンリプレイスを実現し、継続運用しやすいサービス基盤を構築する。

## STAR: 主要ステークホルダーと価値
### Situation
- スケートボード利用者は増加傾向だが、適切な練習場所の認知不足やマナー悪化が課題。
- 業界経験者でもある開発者が、業界改善を目指し情報共有プラットフォームを構築した。
### Task
- 初心者を含む利用者が安全に練習できるスポット情報を検索・共有できる場を提供する。
- 地域コミュニティや管理者にもメリットがある形でスポット情報を可視化する。
### Action
- ユーザー認証、スポット投稿・編集、コメント、評価、位置情報検索など既存機能をspot-diggzへ踏襲。
- 地図表示や画像管理などのUX向上施策を計画し、Rust/GCP基盤で信頼性と拡張性を確保。
### Result
- コミュニティ主導でスポット情報が蓄積され、適切な練習場所への誘導とマナー向上が期待できる。

## STAR: 技術スタック選定の意図
### Situation
- 既存Rails実装ではレガシー化が進み、パフォーマンス・保守性・セキュリティ面で改善余地が大きい。
- 個人開発ながらエンタープライズレベルの設計・運用スキル習得が目標。
### Task
- モノレポ構成でAPI・UI・インフラを一体管理し、学習効果と運用効率を両立する。
- サーバーレスとIaCを活用し、少ないリソースで高品質な運用体制を確立する。
### Action
- バックエンドはRust、フロントはReact/TypeScript、インフラはGCP（Cloud Run・Firestore・Cloud Storage）を採用。
- Terraformによる組織／フォルダ／プロジェクト階層管理、CI/CD・監視・セキュリティのベストプラクティスを導入。
- iOSネイティブアプリはSwift/SwiftUI + MapKitを想定し、共通APIと認可モデルをRustバックエンドに統合する。
### Result
- 学習目的を満たしつつ、将来のスケールやチーム化にも耐えられるアーキテクチャを整備できる。
- Web（参照中心）とiOS（高機能ナビ・投稿中心）が同一APIで連携し、利用シーンに応じたUX最適化が可能になる。

## STAR: マルチチャネル体験設計
### Situation
- ブラウザ利用者はスポット検索・閲覧が中心だが、現地利用時はネイティブアプリの位置情報連携やナビ機能が求められる。
- Apple端末でのMapKit、あるいはGoogle Maps連携によるルート案内を取り込みたい要望がある。
### Task
- 会員登録済みユーザーがiOSアプリ経由でスポットのPIN（位置情報）を自由に投稿できる仕組みを提供する。
- ブラウザでは閲覧・検索体験を重視しつつ、ネイティブアプリではナビゲーションやおすすめルート表示など高機能を提供する。
### Action
- Swift/SwiftUIベースのiOSアプリを追加開発し、Apple MapKitのルート提案APIやLook Aroundと連携する設計を採用する。
- Rustバックエンドに投稿API・認可制限・ルーティングデータ管理を実装し、Firestoreで位置情報履歴とメタデータを保持する。
- 共有ディープリンクからGoogle MapsまたはApple Mapsへハンドオフ可能なスキーム（Universal Links / URL Scheme）を設計する。
### Result
- 技術的にiOSネイティブ拡張は実現可能であり、投稿・ナビの高機能体験とWeb参照体験を両立したマルチチャネル戦略が成立する。
- ユーザーはスポット閲覧から現地ナビまでワンストップで利用でき、コミュニティ投稿の活性化も期待できる。

## 仕様メモ: スポット区分（trustLevel: verified / unverified）
### 目的
- スポットの信頼性と重複を整理し、検索結果の精度を高める。
### 区分定義
- **verified**: 運営主体の存在や外部証跡（YouTube/公式ページ）が確認できるスポット。
- **unverified**: ユーザーが自由に登録したスポット。
### 昇格フロー（モバイルのみ）
- communityとして登録したスポットに対し、申請ボタンからcurated昇格を申請。
- 外部URLを添付し、管理者が手動で承認/却下する。
### データモデル
- `trustLevel`（verified/unverified）
- `trustSources`（外部URL配列、verified時のみ）

## 参考: 現行リポジトリ構成（2024-詳細設計前）
- `api`: RustによるAPIサーバープロジェクト（Cargoベース、スクラッチ実装予定）。
- `ui`: React + TypeScript SPA（npmベース、Cloud Storageから配信予定）。
- `src/ios`（新設予定）: Swift/SwiftUIで実装するネイティブアプリのコードベース。MapKit連携とAPIクライアントを含む。
- `resources`: Terraformによる組織・環境・プロジェクト階層のIaC定義。
- `docs`: 開発手順や要件メモを格納するディレクトリ。
- `scripts`: ローカル／CI向けユーティリティスクリプト。
