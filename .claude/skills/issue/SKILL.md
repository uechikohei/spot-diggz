---
name: issue
description: 指示内容に基づいてGitHub Issueを起票（フォーマット自動判定）
allowed-tools: Bash(gh issue:*), Bash(gh project:*), Bash(gh label:*), WebSearch
---

GitHub Issueを起票してください。以下の手順に従い、フォーマットを自動判定して起票します。

## 手順

### 1. コンテキスト分析

ユーザーの指示内容、または直前の作業コンテキスト（トラブルシューティング結果など）を分析し、以下を判定する:

- **事象の種類**: 障害/バグ/技術的問題 or 企画/検討/設計/要件整理 or その他
- **時制**: 既に発生した（過去） or これから取り組む（未来）
- **ラベル**: `troubleshooting` / `planning` / `design` / `knowledge`
- **優先度**: `P0`（本番障害・ブロッカー） / `P1`（開発に支障） / `P2`（改善・バックログ）

### 2. フォーマット自動選択

以下の基準でフォーマットを自動選択する:

#### 4F形式（Fact/Find/Fix/Future）

**選択条件**: 既に発生した障害、バグ修正、技術調査、トラブルシューティング結果の記録

```markdown
## Priority: P{0,1,2}

## Fact（事実）

何が起きたか。エラーメッセージ、再現手順、影響範囲を具体的に記載。

## Find（原因・分析）

なぜ起きたか。根本原因の特定、関連するコード・設定・依存関係。

## Fix（対応策）

どう直すか。具体的な修正手順を箇条書きで記載。

## Future（再発防止）

今後どうするか。テスト追加、CI強化、ドキュメント更新など。
```

#### STAR形式（Situation/Task/Action/Result）

**選択条件**: 未来の話、新機能の検討、要件整理、設計議論、アップグレード計画

```markdown
## Priority: P{0,1,2}

## Situation（状況）

現在の状態、背景、きっかけ。

## Task（課題）

解決すべき課題、達成したいこと。

## Action（対応計画）

具体的なアクションプランを箇条書きで記載。

## Result（期待される成果）

完了時に得られる成果、成功基準。
```

#### フリーフォーマット

**選択条件**: 4F/STARのいずれにも当てはまらない場合（ナレッジ共有、メモ、議論の記録など）

```markdown
## Priority: P{0,1,2}

## 概要

内容の要約。

## 詳細

詳細情報を箇条書きまたは自由記述で記載。

## 次のアクション

必要なフォローアップがあれば記載。なければ「なし（記録目的）」。
```

### 3. 重複チェック

起票前に既存Issueとの重複を確認する:

```
gh issue list -R uechikohei/spot-diggz --search "KEYWORD" --state all --limit 10
```

重複がある場合はユーザーに報告し、既存Issueへのコメント追加を提案する。

### 4. 起票

```
gh issue create -R uechikohei/spot-diggz \
  --title "<type>(<scope>): タイトル" \
  --label "LABEL" \
  --body "BODY"
```

### 5. Project追加

```
gh project item-add 2 --owner uechikohei --url ISSUE_URL
```

### 6. 結果報告

起票したIssueのURL、フォーマット種別、優先度を報告する。

---

## トラブルシューティング自動起票ルール

Claude Codeのエージェント作業中にトラブルシューティングが発生し、問題が解消した場合:

1. 解消時点で自動的に `/issue` を実行する
2. 作業コンテキスト（エラー内容、原因、修正内容）から4F形式でIssueを生成する
3. ユーザーに起票内容を提示し、承認後に起票する

このルールにより、トラブルシューティングの知見が自動的にIssueとして蓄積される。
